language: rust
rust:
  - nightly

matrix:
  include:
    - os: linux
      dist: xenial
      sudo: required
      addons:
         apt:
           sources:
             - ubuntu-toolchain-r-test
           packages:
            - g++-7
      env:
        - CC=gcc-7
        - CXX=g++-7
    - os: windows
    - os: osx

jobs:
  include:
    - stage: cpu-only
      script: cargo build --release --features=simd
    - stage: cpu-gpu
      if: os = osx # gpu build requires OpenCL, only osx has it
      script: cargo build --release --features=opencl,simd
